"use strict";(self.webpackChunk_minimal_minimal_kit_react=self.webpackChunk_minimal_minimal_kit_react||[]).push([[4844],{84844:function(e,t,n){n.r(t);var i=n(12860),s=n(74165),r=n(15861),a=n(1413),l=n(93433),o=n(29439),c=n(47313),d=n(9019),u=n(63585),h=n(61113),x=n(42832),f=n(94469),p=n(47825),m=n(73428),Z=n(93405),g=n(1550),j=n(88797),v=n(51405),y=n(49914),b=n(57829),w=n(66212),k=n(65280),C=n(48310),S=n(60194),P=n(47131),T=n(32600),_=n(83213),A=n(19536),R=n(56104),I=n(24193),B=n(54299),D=n(83929),E=n(74268),L=n(89840),O=n(61689),N=n(24631),W=n(41727),F=n(98495),U=n(51997),M=n(99132),Y=n(20201),z=n(36974),H=n(56573),J=n(83358),V=n(31387),q=n(94638),X=n(50373),G=n(71673),K=n(15366),Q=n(10859),$=n.n(Q),ee=n(2135),te=n(85582),ne=n(12865),ie=n(82495),se=n(27026),re=n(46417);function ae(e,t,n){return{fontWeight:-1===t.indexOf(e)?n.typography.fontWeightRegular:n.typography.fontWeightMedium}}var le={PaperProps:{style:{maxHeight:224,width:250}}},oe=["All","Open","Pending","Closed"],ce=["itadmin","admin"],de=function(e){var t=e.msg,n=new Date(t.createdOn||Date.now()),i=n.toDateString().split(" "),s=n.toLocaleTimeString().split(" ");return(0,re.jsxs)(d.ZP,{container:!0,item:!0,xs:12,padding:1,children:[(0,re.jsx)(d.ZP,{item:!0,xs:.8,children:(0,re.jsx)(u.Z,{alt:"me",src:t.dp,sx:{height:"30px",width:"30px"}})}),(0,re.jsxs)(d.ZP,{item:!0,xs:10,children:[(0,re.jsx)(h.Z,{variant:"subtitle1",children:t.from}),(0,re.jsx)(h.Z,{variant:"body1",children:t.message})]}),(0,re.jsx)(d.ZP,{item:!0,xs:1.2,children:(0,re.jsxs)(x.Z,{justifyContent:"center",alignItems:"center",children:[(0,re.jsx)(h.Z,{variant:"caption",children:i[1]+" "+i[2]}),(0,re.jsx)(h.Z,{variant:"caption",children:s[0].split(":").slice(0,2).join(":")+" "+s[1]})]})}),0!==t.attachments.length&&(0,re.jsx)(d.ZP,{item:!0,xs:12,justifyContent:"space-between",sx:{width:"100%"},children:t.attachments.map((function(e,t){return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)("a",{href:"string"===typeof e?e:URL.createObjectURL(e),target:"_blank",children:"Attachment ".concat(t+1)})," "]})}))})]})};t.default=function(){var e,t=(0,ne.E)(),n=t.user,Q=(t.getDataByRole,(0,c.useContext)(se.J6)),ue=Q.globalSettings,he=(Q.setGlobalSettings,(0,Y.Z)()),xe=(0,c.useState)(null),fe=(0,o.Z)(xe,2),pe=fe[0],me=fe[1],Ze=(0,c.useState)(!1),ge=(0,o.Z)(Ze,2),je=ge[0],ve=ge[1],ye=(0,c.useState)(!1),be=(0,o.Z)(ye,2),we=be[0],ke=be[1],Ce=(0,c.useState)("All"),Se=(0,o.Z)(Ce,2),Pe=Se[0],Te=Se[1],_e=(0,c.useState)(""),Ae=(0,o.Z)(_e,2),Re=Ae[0],Ie=Ae[1],Be=(0,c.useState)([]),De=(0,o.Z)(Be,2),Ee=De[0],Le=De[1],Oe=(0,c.useState)(null),Ne=(0,o.Z)(Oe,2),We=Ne[0],Fe=Ne[1],Ue=(0,c.useState)("myTickets"),Me=(0,o.Z)(Ue,2),Ye=Me[0],ze=Me[1],He=(0,c.useState)([]),Je=(0,o.Z)(He,2),Ve=Je[0],qe=Je[1],Xe=c.useState(!1),Ge=(0,o.Z)(Xe,2),Ke=Ge[0],Qe=Ge[1],$e=c.useState(""),et=(0,o.Z)($e,2),tt=et[0],nt=et[1],it=c.useState("1"),st=(0,o.Z)(it,2),rt=st[0],at=st[1],lt=function(){var e=K.RZ.collection(K.hJ).where("company","==",n.company),t=[];e.get().then((function(e){e.forEach((function(e){var i=e.data();e.id!==n.uid&&(i.uid=e.id,t.push(i))})),ut(t)}))},ot=(0,c.useState)([]),ct=(0,o.Z)(ot,2),dt=ct[0],ut=ct[1],ht=function(e,t){lt(),At("None"),Dt([]),Qe(!0),nt(t)},xt=function(){Qe(!1),St(!1)},ft=function(e,t,n,i,s,r){Le((function(r){return[].concat((0,l.Z)(r),[{from:n,message:e,attachments:t,dp:i,email:s}])})),Ie(""),ln([]);var o=(new Date).toISOString(),c={from:n,message:e,attachments:t,email:s,dp:i};if(0!==t.length)return c;H.Z.patch("".concat(z.BC,"/tickets/chat/").concat(We._id),{chatData:c}).then((function(e){qe((function(e){var t,n=e[r];return null===n||void 0===n||null===(t=n.chats)||void 0===t||t.push((0,a.Z)((0,a.Z)({},c),{},{createdOn:o})),e[r]=n,e}))}))},pt=function(e){pe.emit("sendMessage",e)},mt=function(e){Te(e.target.innerText)},Zt=(0,c.useState)(null),gt=(0,o.Z)(Zt,2),jt=gt[0],vt=gt[1],yt=function(){K.RZ.collection(K.hJ).where("teams","array-contains-any",["tickets"]).get().then((function(e){var t=[];e.forEach((function(e){var i=e.data();e.id!==n.uid&&(i.uid=e.id,t.push(i))})),vt(t)}))};(0,c.useEffect)((function(){yt()}),[]);var bt=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={selectedEmployee:_t,selectedTasks:Bt},e.next=3,H.Z.patch("".concat(z.BC,"/tickets"),{formData:t});case 3:e.sent.data===Bt.length&&(V.Am.success("Tickets Assigned to "+_t),Fe((function(e){return(0,a.Z)((0,a.Z)({},e),{},{assigned:_t})})),qe((function(e){return Bt.forEach((function(e){Ve.find((function(t){return t._id===e})).assigned=_t})),e})),At("None"),Dt([]));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),wt=(0,c.useState)(!1),kt=(0,o.Z)(wt,2),Ct=kt[0],St=kt[1],Pt=(0,c.useState)("None"),Tt=(0,o.Z)(Pt,2),_t=Tt[0],At=Tt[1],Rt=(0,c.useState)([]),It=(0,o.Z)(Rt,2),Bt=It[0],Dt=It[1],Et=function(e){var t=e.target.value;Dt(t)},Lt=(0,c.useState)("open"),Ot=(0,o.Z)(Lt,2),Nt=Ot[0],Wt=Ot[1],Ft=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=We,e.next=3,H.Z.patch("".concat(z.BC,"/tickets?operation=status"),{formData:{_id:n._id,status:t}});case 3:1===e.sent.data&&(Ve[n.index].status=t,Wt(t),H.Z.post("".concat(z.BC,"/email/send?service=ticket&event=").concat(t),{formData:{to:n.email,ref:n,companyName:ue.name}}).then((function(e){console.log(e.data)})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ut=(0,c.useState)(!1),Mt=(0,o.Z)(Ut,2),Yt=Mt[0],zt=Mt[1],Ht=(0,c.useState)(""),Jt=(0,o.Z)(Ht,2),Vt=Jt[0],qt=Jt[1],Xt=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(){var t,r,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=We,r={ticketId:We._id,reply:{email:n.email,from:n.displayName,dp:"",message:Vt}},e.next=4,H.Z.patch("".concat(z.BC,"/tickets/pvtreply"),{formData:r});case 4:200===e.sent.status&&((l=Ve[t.index].replies)||(0,i.Z)("temp"),l.push(r.reply),Ve[t.index].replies=l,(null===We||void 0===We?void 0:We._id)===t._id&&Fe((function(e){return(0,a.Z)((0,a.Z)({},Ve[t.index]),{},{index:e.index})}))),qt("");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Gt=(0,c.useState)(null),Kt=(0,o.Z)(Gt,2),Qt=Kt[0],$t=Kt[1],en=Boolean(Qt),tn=function(){$t(null)},nn=(0,c.useRef)(),sn=(0,c.useState)([]),rn=(0,o.Z)(sn,2),an=rn[0],ln=rn[1],on=new Set(["admin","itadmin"]),cn=(0,c.useState)((function(){return n.firestore.settings?n.firestore.settings:{}})),dn=(0,o.Z)(cn,2),un=dn[0],hn=dn[1];return(0,c.useEffect)((function(){var e=document.getElementById("ticketUIContainer");return e.style.height="".concat(window.innerHeight-108,"px"),window.addEventListener("resize",(function(){e.style.height="".concat(window.innerHeight-108,"px")})),function(){return window.removeEventListener("resize",(function(){console.log("window resize listener removed")}))}}),[]),(0,c.useEffect)((function(){var e=document.getElementById("searchBar"),t=document.getElementById("chatBox");t.scrollHeight>t.offsetHeight&&(e.style.position="sticky"),t.scrollTop=t.scrollHeight}),[Ee]),(0,c.useEffect)((function(){We&&Le(We.chats)}),[We]),(0,c.useEffect)((function(){n&&(me((0,J.ZP)(z.BC,{query:{email:n.email}})),"myTickets"===Ye?H.Z.get("".concat(z.BC,"/tickets/").concat(n.company,"?email=").concat(n.email)).then((function(e){qe(e.data);mt({target:{innerText:"Open"}})})):ce.includes(n.firestore.role)?H.Z.get("".concat(z.BC,"/tickets/").concat(n.company)).then((function(e){qe(e.data)})):H.Z.get("".concat(z.BC,"/tickets/").concat(n.company,"?assigned=").concat(n.email)).then((function(e){qe(e.data);mt({target:{innerText:"Open"}})})))}),[n,Ye]),(0,c.useEffect)((function(){if(pe)return pe.on("recieveMessage",(function(e){var t=e.ticketId,n=Ve.find((function(e){return e._id===t}));n&&(n.chats.push(e),(null===We||void 0===We?void 0:We._id)===t&&Fe((0,a.Z)({},n)))})),function(){pe.off("recieveMessage")}}),[pe,Ve,We]),(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(f.Z,{maxWidth:"sm",fullWidth:!0,fullScreen:"Settings"===tt,open:Ke,onClose:xt,PaperProps:{style:{maxHeight:"Settings"===tt?null:"75vh",overflowY:"auto"}},children:(0,re.jsx)(p.Z,{sx:{mt:3,mb:3},children:(0,re.jsxs)(m.Z,{variant:"outlined",children:[(0,re.jsxs)(Z.Z,{children:["Team"!==tt?(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,re.jsx)(h.Z,{variant:"h2",children:tt})}),(0,re.jsx)("br",{})]}):null,"Assign Tickets"===tt?(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(h.Z,{variant:"p",children:"Select Employee"}),(0,re.jsx)("br",{}),(0,re.jsx)(g.Z,{fullWidth:!0,children:(0,re.jsxs)(j.Z,{fullWidth:!0,id:"demo-simple-select",value:_t,onChange:function(e){At(e.target.value)},children:[jt?(0,re.jsx)(v.Z,{value:"None",children:"None"}):(0,re.jsx)(v.Z,{value:"None",children:"No employee found"}),jt&&jt.map((function(e,t){return(0,re.jsx)(v.Z,{value:e.email,children:e.email},e.email)}))]})}),(0,re.jsx)("br",{}),(0,re.jsx)("br",{}),(0,re.jsx)(h.Z,{variant:"p",children:"Select Tickets to assign."}),(0,re.jsx)("br",{}),(0,re.jsx)(g.Z,{disabled:Ct,fullWidth:!0,children:(0,re.jsx)(j.Z,{id:"demo-multiple-chip",multiple:!0,value:Bt,onChange:Et,input:(0,re.jsx)(y.Z,{id:"select-multiple-chip",label:"Managers"}),renderValue:function(e){return(0,re.jsx)(b.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((function(e){return(0,re.jsx)(w.Z,{label:Ve.find((function(t){return t._id===e})).title},e)}))})},MenuProps:le,children:Ve.map((function(e){var t=e._id,n=e.title;if(!e.assigned)return(0,re.jsx)(v.Z,{value:t,style:ae(n,Ve,he),children:n},t)}))})})]}):"Team"===tt?(0,re.jsx)(re.Fragment,{children:(0,re.jsx)(b.Z,{sx:{width:"100%",typography:"body1"},children:(0,re.jsxs)(q.ZP,{value:rt,children:[(0,re.jsx)(b.Z,{sx:{borderBottom:2,borderColor:"divider"},children:(0,re.jsxs)(X.Z,{onChange:function(e,t){e.preventDefault(),at(t),"1"===t&&lt()},textColor:"secondary",indicatorColor:"secondary","aria-label":"lab API tabs example",centered:!0,children:[(0,re.jsx)(k.Z,{label:"Team Members",value:"1"}),(0,re.jsx)(k.Z,{label:"Add Members",value:"2"})]})}),(0,re.jsx)(G.Z,{value:"1",children:(0,re.jsx)(C.Z,{sx:{p:0},children:dt.map((function(e,t){var n;if(null!==(n=e.teams)&&void 0!==n&&n.includes("tickets"))return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsxs)(S.ZP,{id:e.uid,sx:{p:0},secondaryAction:(0,re.jsx)(P.Z,{edge:"end","aria-label":"delete",sx:{borderRadius:"50%"},onClick:function(){K.RZ.collection(K.hJ).doc(e.uid).update({teams:$().firestore.FieldValue.arrayRemove("tickets")}).then((function(t){document.getElementById(e.uid).style.display="none"}))},children:(0,re.jsx)(U.Z,{})}),children:[(0,re.jsx)(T.Z,{children:(0,re.jsx)(u.Z,{alt:"DP",src:e.photoURL})}),(0,re.jsx)(_.Z,{primary:e.displayName,secondary:e.email})]},t),(0,re.jsx)(A.Z,{})]})}))})}),(0,re.jsxs)(G.Z,{value:"2",children:[(0,re.jsx)(h.Z,{variant:"p",children:"Select Employees"}),(0,re.jsx)("br",{}),(0,re.jsx)(g.Z,{fullWidth:!0,children:(0,re.jsx)(j.Z,{id:"demo-multiple-chip",multiple:!0,value:Bt,onChange:Et,input:(0,re.jsx)(y.Z,{id:"select-multiple-chip",label:"Managers"}),renderValue:function(e){return(0,re.jsx)(b.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((function(e){return(0,re.jsx)(w.Z,{label:e},e)}))})},MenuProps:le,children:dt.map((function(e){if(e.teams&&!e.teams.includes("tickets"))return(0,re.jsx)(v.Z,{value:e.email,style:ae(e.email,dt,he),children:e.email},e.email)}))})})]})]})})}):"Settings"===tt?(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)("br",{}),(0,re.jsx)(d.ZP,{container:!0,children:(0,re.jsxs)(d.ZP,{item:!0,xs:6,children:[(0,re.jsx)(h.Z,{variant:"subtitle1",children:"Appoint a substitute:"}),(0,re.jsx)(g.Z,{fullWidth:!0,children:(0,re.jsxs)(j.Z,{fullWidth:!0,id:"demo-simple-select",value:un.appointed?un.appointed:"None",onChange:function(e){hn((function(t){return(0,a.Z)((0,a.Z)({},t),{},{appointed:e.target.value})}))},children:[dt?(0,re.jsx)(v.Z,{value:"None",children:"None"}):(0,re.jsx)(v.Z,{value:"None",children:"No employee found"}),dt&&dt.map((function(e,t){if(!on.has(e.role))return(0,re.jsx)(v.Z,{value:e.email,children:"".concat(e.email," (").concat(e.role,")")},e.email)}))]})})]})})]}):null]}),(0,re.jsxs)(R.Z,{sx:{float:"right"},style:{padding:"0px 20px 20px"},children:[(0,re.jsx)(I.Z,{onClick:function(){"Settings"===tt&&hn(n.firestore.settings?n.firestore.settings:{}),xt()},children:"Close"}),"1"!==rt||"Assign Tickets"===tt?(0,re.jsx)(I.Z,{size:"small",onClick:function(){if("Team"===tt){var e=dt.filter((function(e){return Bt.includes(e.email)})),t=[];e.forEach((function(e){t.push(K.RZ.collection(K.hJ).doc(e.uid).update({teams:$().firestore.FieldValue.arrayUnion("tickets")}))})),Promise.all(t).then((function(e){console.log("Teams Updated")})),at("1")}else"Assign Tickets"===tt&&bt();xt()},variant:"contained",children:"Submit"}):"Settings"===tt?(0,re.jsx)(I.Z,{size:"small",variant:"contained",onClick:function(){K.RZ.collection(K.hJ).doc(n.uid).update({settings:un}).then((function(){V.Am.success("Applied settings"),n.firestore.settings=un})),xt()},children:"Save"}):null]})]})})}),(0,re.jsx)(g.Z,{children:(0,re.jsxs)(B.Z,{row:!0,"aria-labelledby":"demo-controlled-radio-buttons-group",name:"controlled-radio-buttons-group",value:Ye,onChange:function(e){ze(e.target.value)},children:[(0,re.jsx)(D.Z,{value:"myTickets",control:(0,re.jsx)(E.Z,{}),label:"My Tickets"}),(0,re.jsx)(D.Z,{value:"assigned",control:(0,re.jsx)(E.Z,{}),label:ce.includes(n.firestore.role)?"All Tickets":"Assigned Tickets"})]})}),(0,re.jsx)("br",{}),(0,re.jsx)("br",{}),(0,re.jsx)("div",{id:"ticketUIContainer",style:{border:"2px solid #f0f0f0",borderRadius:"25px",overflowY:"hidden"},children:(0,re.jsxs)(d.ZP,{container:!0,sx:{height:"100%"},children:[!1,(0,re.jsx)(d.ZP,{container:!0,item:!0,xs:je||Yt||we?3:3.5,spacing:2,sx:{height:"100%"},children:(0,re.jsxs)(d.ZP,{item:!0,xs:12,sx:{height:"100%"},children:[(0,re.jsxs)(x.Z,{direction:"row",justifyContent:"space-around",alignItems:"center",sx:{paddingX:"7px",paddingY:"5px"},children:[ce.includes(null===n||void 0===n?void 0:n.firestore.role)&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(P.Z,{onClick:function(e){$t(e.currentTarget)},children:(0,re.jsx)(ie.Z,{})}),(0,re.jsxs)(te.Z,{id:"basic-menu",anchorEl:Qt,open:en,onClose:tn,MenuListProps:{"aria-labelledby":"basic-button"},children:[(0,re.jsx)(v.Z,{onClick:function(e){tn(),ht(0,"Team")},children:"Team"}),(0,re.jsx)(v.Z,{onClick:function(e){tn(),yt(),ht(0,"Assign Tickets"),Dt([])},children:"Assign Tickets"}),(0,re.jsx)(v.Z,{onClick:function(e){tn(),ht(0,"Settings")},children:"Settings"})]})]}),oe.map((function(e){return(0,re.jsx)(h.Z,{width:"85%",textAlign:"center",display:"itadmin"!==(null===n||void 0===n?void 0:n.firestore.role)&&"All"===e?"none":"",variant:"subtitle1",name:e,style:{cursor:"pointer",color:Pe===e?"blue":"",backgroundColor:Pe===e?"#ebecf0":"",borderRadius:"50px"},onClick:mt,children:e})}))]}),(0,re.jsx)(A.Z,{}),(0,re.jsx)(C.Z,{sx:{backgroundColor:"#f5f6fa",py:0,height:"98%",overflowY:"auto"},children:Ve.map((function(e,t){if("All"===Pe||e.status===Pe.toLowerCase()){var i=new Date(e.createdOn).toDateString().split(" ");return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(L.Z,{sx:{px:1,py:1,backgroundColor:e._id===(null===We||void 0===We?void 0:We._id)?"#b2ccfe":"transparent"},onClick:function(){if(e._id!==(null===We||void 0===We?void 0:We._id)){var n=document.getElementById("searchBar");n.style.position="absolute",n.style.bottom="0px",zt(!1),Fe((0,a.Z)((0,a.Z)({},e),{},{index:t})),Wt(e.status)}},children:(0,re.jsxs)(d.ZP,{container:!0,children:[(0,re.jsx)(d.ZP,{container:!0,item:!0,xs:2,justifyContent:"center",sx:{overflowX:"clip"},children:(0,re.jsx)(u.Z,{alt:"user pic",src:e.photoURL===(null===n||void 0===n?void 0:n.photoURL)?e.assigned:e.photoURL})}),(0,re.jsxs)(d.ZP,{item:!0,xs:10,children:[(0,re.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",width:"100%",children:[(0,re.jsx)(re.Fragment,{children:"itadmin"===(null===n||void 0===n?void 0:n.firestore.role)?(0,re.jsx)("div",{style:{width:"75%"},children:(0,re.jsx)(h.Z,{variant:"caption",noWrap:!0,onClick:function(){ke(!1),ve(!0)},onMouseOver:function(e){e.target.style.color="blue"},onMouseLeave:function(e){e.target.style.color=""},children:e.name})}):(0,re.jsxs)(h.Z,{variant:"caption",style:{width:"75%"},noWrap:!0,children:["#",e._id]})}),(0,re.jsx)(h.Z,{variant:"overline",style:{width:"25%",textAlign:"right"},children:i[1]+" "+i[2]})]}),(0,re.jsx)(h.Z,{width:"100%",noWrap:!0,variant:"subtitle1",children:e.title}),(0,re.jsx)(h.Z,{width:"100%",noWrap:!0,variant:"subtitle2",children:e.desc})]})]})},e._id),t!==Ve.length-1&&(0,re.jsx)(A.Z,{})]})}}))})]})}),(0,re.jsx)(A.Z,{orientation:"vertical",flexItem:!0}),(0,re.jsxs)(d.ZP,{id:"chatContainer",container:!0,item:!0,xs:je||Yt||we?5.96:8.46,sx:{height:"100%"},children:[(0,re.jsxs)(d.ZP,{id:"chatHeader",item:!0,xs:12,children:[(0,re.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{padding:"5px"},children:[(0,re.jsxs)("div",{style:{marginLeft:"16px"},children:[We?(0,re.jsxs)(x.Z,{direction:"row",children:[(0,re.jsx)(ee.rU,{onClick:function(){We&&ce.includes(null===n||void 0===n?void 0:n.firestore.role)&&zt(!0)},children:(0,re.jsx)(O.Z,{title:ce.includes(null===n||void 0===n?void 0:n.firestore.role)?"View all private replies":"Ticket Title",children:(0,re.jsx)(h.Z,{variant:"h4",children:(null===We||void 0===We?void 0:We.title)||"Select a ticket"})})}),(null===We||void 0===We?void 0:We.assigned)&&(0,re.jsx)(O.Z,{title:"Assigned to ".concat(null===We||void 0===We?void 0:We.assigned),children:(0,re.jsx)("img",{style:{marginLeft:"8px",height:"25px",width:"25px",float:"right"},src:"https://img.icons8.com/color/25/null/checked--v1.png"})})]}):(0,re.jsx)(h.Z,{variant:"h4",children:(null===We||void 0===We?void 0:We.title)||"Select a ticket"}),(0,re.jsx)(h.Z,{variant:"body1",children:null===We||void 0===We?void 0:We.desc})]}),ce.includes(null===n||void 0===n?void 0:n.firestore.role)&&(0,re.jsxs)(x.Z,{direction:"row",spacing:1,alignItems:"center",children:[We&&(0,re.jsx)(I.Z,{size:"small",onClick:function(e){ht(0,"Assign Tickets"),St(!0),Dt([We._id])},children:null===(null===We||void 0===We?void 0:We.assigned)?"Assign":"Re-Assign"}),We&&(0,re.jsx)(g.Z,{size:"small",children:(0,re.jsxs)(j.Z,{id:"demo-simple-select",value:Nt,onChange:function(e){Ft(e.target.value)},children:[(0,re.jsx)(v.Z,{value:"open",children:"Open"}),(0,re.jsx)(v.Z,{value:"pending",children:"Pending"}),(0,re.jsx)(v.Z,{value:"closed",children:"Closed"})]})})]})]}),(0,re.jsx)(A.Z,{})]}),(0,re.jsx)(d.ZP,{item:!0,xs:12,sx:{height:"91%",paddingY:"4px"},children:(0,re.jsxs)("div",{id:"chatBox",style:{position:"relative",overflowY:"auto",height:"100%"},children:[(0,re.jsx)(C.Z,{sx:{p:0},children:null===Ee||void 0===Ee?void 0:Ee.map((function(e,t){return e.email===n.email&&(e.from="You"),(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(L.Z,{id:"chatLog-".concat(e._id),sx:{p:0,cursor:"default"},children:(0,re.jsx)(de,{msg:e},t)}),(0,re.jsx)(A.Z,{})]})}))}),(0,re.jsxs)("div",{id:"searchBar",style:{position:"absolute",bottom:"0px",width:"100%",backgroundColor:"#ffffff"},children:[0!==an.length&&(0,re.jsx)(d.ZP,{item:!0,xs:12,justifyContent:"space-evenly",children:Object.values(an).map((function(e){return(0,re.jsx)(h.Z,{variant:"caption",children:e.name})}))}),(0,re.jsxs)(x.Z,{direction:"row",spacing:2,justifyContent:"center",sx:{width:"100%",paddingY:1},children:[(0,re.jsx)(N.Z,{placeholder:"Type your query here ...",sx:{width:"80%"},value:Re,InputProps:{endAdornment:(0,re.jsx)(W.Z,{position:"end",children:(0,re.jsxs)(P.Z,{sx:{borderRadius:"50%"},"aria-label":"toggle password visibility",onClick:function(e){return nn.current.click()},edge:"end",children:[(0,re.jsx)("input",{ref:nn,type:"file",multiple:!0,hidden:!0,onChange:function(e){return ln(e.target.files)}}),(0,re.jsx)(M.Z,{})]})})},onChange:function(e){return Ie(e.target.value)}}),(0,re.jsx)(I.Z,{disabled:!We||"itadmin"!==n.firestore.role&&!(null!==We&&void 0!==We&&We.assigned),variant:"contained",onClick:function(e){if(an.length){var t=We,i=ft(Re,Object.values(an),n.displayName,n.photoURL,n.email,null===We||void 0===We?void 0:We.index),l=Object.values(an).map((function(e){return new Promise((function(t,n){var i=(new Date).getTime()+e.name,s=K.tO.ref().child("/Attachments/".concat(i)).put(e);s.on("state_changed",(function(e){Math.floor(e.bytesTransferred/e.totalBytes*100)}),(function(e){console.log(e)}),(function(){s.snapshot.ref.getDownloadURL().then((function(e){t(e)})).catch((function(e){console.log(e)}))}))}))}));Promise.all(l).then((function(e){var s=n.email===t.email?t.assigned:t.email;pt({message:Re,attachments:e,to:s,from:n.displayName,email:n.email,dp:n.photoURL,ticketId:t._id,createdOn:(new Date).toISOString()}),i.attachments=e,H.Z.patch("".concat(z.BC,"/tickets/chat/").concat(t._id),{chatData:i}).then((function(e){qe((function(e){var n,s=e[null===t||void 0===t?void 0:t.index];return null===s||void 0===s||null===(n=s.chats)||void 0===n||n.push((0,a.Z)((0,a.Z)({},i),{},{createdOn:(new Date).toISOString()})),e[null===t||void 0===t?void 0:t.index]=s,e}))}))}))}else!function(e,t){return function(){var i=(0,r.Z)((0,s.Z)().mark((function i(r){var a;return(0,s.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(Re){i.next=2;break}return i.abrupt("return");case 2:a=n.email===We.email?We.assigned:We.email,pt({message:Re,attachments:t,to:a,from:n.displayName,email:n.email,dp:n.photoURL,ticketId:We._id,createdOn:(new Date).toISOString()}),ft(Re,t,n.displayName,n.photoURL,n.email,e);case 5:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()}(null===We||void 0===We?void 0:We.index,[])()},children:"Send"})]})]})]})})]}),je&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(A.Z,{orientation:"vertical",flexItem:!0}),(0,re.jsx)(d.ZP,{container:!0,item:!0,xs:3,sx:{height:"100%"},children:(0,re.jsxs)(d.ZP,{item:!0,xs:12,children:[(0,re.jsx)(P.Z,{sx:{float:"right",borderRadius:"50%"},onClick:function(){return ve(!1)},children:(0,re.jsx)(F.Z,{})}),We&&(0,re.jsxs)("center",{style:{padding:"40px 0px"},children:[(0,re.jsx)(u.Z,{alt:"profile user",src:We.photoURL,sx:{width:75,height:75}}),(0,re.jsx)("br",{}),(0,re.jsx)(h.Z,{variant:"h3",children:We.name})]}),(0,re.jsx)(A.Z,{})]})})]}),Yt&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(A.Z,{orientation:"vertical",flexItem:!0}),(0,re.jsxs)(d.ZP,{container:!0,item:!0,xs:3,sx:{px:1,height:"100%"},children:[(0,re.jsxs)(d.ZP,{item:!0,xs:12,sx:{height:"28%"},children:[(0,re.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,re.jsx)(h.Z,{variant:"caption",children:"All private replies"}),(0,re.jsx)(P.Z,{sx:{borderRadius:"50%"},onClick:function(){zt(!1)},children:(0,re.jsx)(F.Z,{})})]}),We&&(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(N.Z,{fullWidth:!0,multiline:!0,rows:3,value:Vt,onChange:function(e){return qt(e.target.value)}}),(0,re.jsx)(I.Z,{disabled:!Vt,size:"small",sx:{float:"right",mt:1},variant:"contained",onClick:Xt,children:"Add"})]})]}),(0,re.jsx)(d.ZP,{item:!0,xs:12,sx:{height:"72%"},children:(0,re.jsx)(C.Z,{dense:!0,sx:{p:0,height:"100%",overflowY:"auto"},children:null===We||void 0===We||null===(e=We.replies)||void 0===e?void 0:e.map((function(e){if(e.email===n.email){var t=new Date(e.createdOn||Date.now()),i=t.toDateString().split(" "),s=t.toLocaleTimeString().split(" ");return(0,re.jsxs)(re.Fragment,{children:[(0,re.jsx)(S.ZP,{sx:{p:0},children:(0,re.jsxs)("div",{style:{width:"100%"},children:[(0,re.jsx)(h.Z,{variant:"body1",children:e.message}),(0,re.jsxs)(x.Z,{sx:{width:"100%"},direction:"row",justifyContent:"flex-end",alignItems:"center",children:[(0,re.jsx)(h.Z,{variant:"caption",sx:{mr:1},children:i[1]+" "+i[2]}),(0,re.jsx)(h.Z,{variant:"caption",children:s[0].split(":").slice(0,2).join(":")+" "+s[1]})]})]})}),(0,re.jsx)(A.Z,{})]})}}))})})]})]})]})})]})}}}]);