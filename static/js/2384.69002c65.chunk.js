"use strict";(self.webpackChunk_minimal_minimal_kit_react=self.webpackChunk_minimal_minimal_kit_react||[]).push([[2384],{72384:function(e,t,n){n.r(t);var i=n(12860),s=n(74165),r=n(15861),a=n(1413),l=n(93433),o=n(29439),c=n(72791),d=n(61889),u=n(60220),h=n(20890),x=n(36314),f=n(5574),p=n(10524),m=n(57621),Z=n(39504),j=n(68096),g=n(58406),v=n(23786),y=n(77196),b=n(64554),w=n(81918),k=n(43896),C=n(90493),S=n(45484),P=n(13400),T=n(20653),_=n(49900),A=n(94721),R=n(72363),I=n(24518),B=n(88970),D=n(85523),E=n(61419),L=n(76278),O=n(20068),N=n(48550),W=n(63466),F=n(64721),U=n(27247),M=n(99663),Y=n(29598),z=n(33805),H=n(31243),V=n(44428),J=n(75985),q=n(83449),X=n(47283),G=n(82851),K=n(26467),Q=n(5154),$=n.n(Q),ee=n(11087),te=n(31976),ne=n(78316),ie=n(87122),se=n(80184);function re(e,t,n){return{fontWeight:-1===t.indexOf(e)?n.typography.fontWeightRegular:n.typography.fontWeightMedium}}var ae={PaperProps:{style:{maxHeight:224,width:250}}},le=["All","Open","Pending","Closed"],oe=["itadmin","admin"],ce=function(e){var t=e.msg,n=new Date(t.createdOn||Date.now()),i=n.toDateString().split(" "),s=n.toLocaleTimeString().split(" ");return(0,se.jsxs)(d.ZP,{container:!0,item:!0,xs:12,padding:1,children:[(0,se.jsx)(d.ZP,{item:!0,xs:.8,children:(0,se.jsx)(u.Z,{alt:"me",src:t.dp,sx:{height:"30px",width:"30px"}})}),(0,se.jsxs)(d.ZP,{item:!0,xs:10,children:[(0,se.jsx)(h.Z,{variant:"subtitle1",children:t.from}),(0,se.jsx)(h.Z,{variant:"body1",children:t.message})]}),(0,se.jsx)(d.ZP,{item:!0,xs:1.2,children:(0,se.jsxs)(x.Z,{justifyContent:"center",alignItems:"center",children:[(0,se.jsx)(h.Z,{variant:"caption",children:i[1]+" "+i[2]}),(0,se.jsx)(h.Z,{variant:"caption",children:s[0].split(":").slice(0,2).join(":")+" "+s[1]})]})}),0!==t.attachments.length&&(0,se.jsx)(d.ZP,{item:!0,xs:12,justifyContent:"space-between",sx:{width:"100%"},children:t.attachments.map((function(e,t){return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)("a",{href:"string"===typeof e?e:URL.createObjectURL(e),target:"_blank",children:"Attachment ".concat(t+1)})," "]})}))})]})};t.default=function(){var e,t=(0,ne.E)(),n=t.user,Q=(t.getDataByRole,(0,Y.Z)()),de=(0,c.useState)(null),ue=(0,o.Z)(de,2),he=ue[0],xe=ue[1],fe=(0,c.useState)(!1),pe=(0,o.Z)(fe,2),me=pe[0],Ze=pe[1],je=(0,c.useState)(!1),ge=(0,o.Z)(je,2),ve=ge[0],ye=ge[1],be=(0,c.useState)("All"),we=(0,o.Z)(be,2),ke=we[0],Ce=we[1],Se=(0,c.useState)(""),Pe=(0,o.Z)(Se,2),Te=Pe[0],_e=Pe[1],Ae=(0,c.useState)([]),Re=(0,o.Z)(Ae,2),Ie=Re[0],Be=Re[1],De=(0,c.useState)(null),Ee=(0,o.Z)(De,2),Le=Ee[0],Oe=Ee[1],Ne=(0,c.useState)("myTickets"),We=(0,o.Z)(Ne,2),Fe=We[0],Ue=We[1],Me=(0,c.useState)([]),Ye=(0,o.Z)(Me,2),ze=Ye[0],He=Ye[1],Ve=c.useState(!1),Je=(0,o.Z)(Ve,2),qe=Je[0],Xe=Je[1],Ge=c.useState(""),Ke=(0,o.Z)(Ge,2),Qe=Ke[0],$e=Ke[1],et=c.useState("1"),tt=(0,o.Z)(et,2),nt=tt[0],it=tt[1],st=function(){var e=K.RZ.collection(K.hJ).where("company","==",n.company),t=[];e.get().then((function(e){e.forEach((function(e){var i=e.data();e.id!==n.uid&&(i.uid=e.id,t.push(i))})),ot(t)}))},rt=(0,c.useState)([]),at=(0,o.Z)(rt,2),lt=at[0],ot=at[1],ct=function(e,t){st(),Pt("None"),Rt([]),Xe(!0),$e(t)},dt=function(){Xe(!1),wt(!1)},ut=function(e,t,n,i,s,r){Be((function(r){return[].concat((0,l.Z)(r),[{from:n,message:e,attachments:t,dp:i,email:s}])})),_e(""),sn([]);var o=(new Date).toISOString(),c={from:n,message:e,attachments:t,email:s,dp:i};if(0!==t.length)return c;H.Z.patch("".concat(z.BC,"/tickets/chat/").concat(Le._id),{chatData:c}).then((function(e){He((function(e){var t,n=e[r];return null===n||void 0===n||null===(t=n.chats)||void 0===t||t.push((0,a.Z)((0,a.Z)({},c),{},{createdOn:o})),e[r]=n,e}))}))},ht=function(e){he.emit("sendMessage",e)},xt=function(e){Ce(e.target.innerText)},ft=(0,c.useState)(null),pt=(0,o.Z)(ft,2),mt=pt[0],Zt=pt[1],jt=function(){K.RZ.collection(K.hJ).where("teams","array-contains-any",["tickets"]).get().then((function(e){var t=[];e.forEach((function(e){var i=e.data();e.id!==n.uid&&(i.uid=e.id,t.push(i))})),Zt(t)}))};(0,c.useEffect)((function(){jt()}),[]);var gt=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={selectedEmployee:St,selectedTasks:At},e.next=3,H.Z.patch("".concat(z.BC,"/tickets"),{formData:t});case 3:e.sent.data===At.length&&(J.Am.success("Tickets Assigned to "+St),Oe((function(e){return(0,a.Z)((0,a.Z)({},e),{},{assigned:St})})),He((function(e){return At.forEach((function(e){ze.find((function(t){return t._id===e})).assigned=St})),e})),Pt("None"),Rt([]));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),vt=(0,c.useState)(!1),yt=(0,o.Z)(vt,2),bt=yt[0],wt=yt[1],kt=(0,c.useState)("None"),Ct=(0,o.Z)(kt,2),St=Ct[0],Pt=Ct[1],Tt=(0,c.useState)([]),_t=(0,o.Z)(Tt,2),At=_t[0],Rt=_t[1],It=function(e){var t=e.target.value;Rt(t)},Bt=(0,c.useState)("open"),Dt=(0,o.Z)(Bt,2),Et=Dt[0],Lt=Dt[1],Ot=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Le,e.next=3,H.Z.patch("".concat(z.BC,"/tickets?operation=status"),{formData:{_id:n._id,status:t}});case 3:1===e.sent.data&&(ze[n.index].status=t,Lt(t),H.Z.post("".concat(z.BC,"/email/send?service=ticket&event=").concat(t),{formData:{to:n.email,ref:n}}).then((function(e){console.log(e.data)})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Nt=(0,c.useState)(!1),Wt=(0,o.Z)(Nt,2),Ft=Wt[0],Ut=Wt[1],Mt=(0,c.useState)(""),Yt=(0,o.Z)(Mt,2),zt=Yt[0],Ht=Yt[1],Vt=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(){var t,r,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Le,r={ticketId:Le._id,reply:{email:n.email,from:n.displayName,dp:"",message:zt}},e.next=4,H.Z.patch("".concat(z.BC,"/tickets/pvtreply"),{formData:r});case 4:200===e.sent.status&&((l=ze[t.index].replies)||(0,i.Z)("temp"),l.push(r.reply),ze[t.index].replies=l,(null===Le||void 0===Le?void 0:Le._id)===t._id&&Oe((function(e){return(0,a.Z)((0,a.Z)({},ze[t.index]),{},{index:e.index})}))),Ht("");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Jt=(0,c.useState)(null),qt=(0,o.Z)(Jt,2),Xt=qt[0],Gt=qt[1],Kt=Boolean(Xt),Qt=function(){Gt(null)},$t=(0,c.useRef)(),en=(0,c.useState)([]),tn=(0,o.Z)(en,2),nn=tn[0],sn=tn[1],rn=new Set(["admin","itadmin"]),an=(0,c.useState)((function(){return n.firestore.settings?n.firestore.settings:{}})),ln=(0,o.Z)(an,2),on=ln[0],cn=ln[1];return(0,c.useEffect)((function(){var e=document.getElementById("ticketUIContainer");return e.style.height="".concat(window.innerHeight-108,"px"),window.addEventListener("resize",(function(){e.style.height="".concat(window.innerHeight-108,"px")})),function(){return window.removeEventListener("resize",(function(){console.log("window resize listener removed")}))}}),[]),(0,c.useEffect)((function(){var e=document.getElementById("searchBar"),t=document.getElementById("chatBox");t.scrollHeight>t.offsetHeight&&(e.style.position="sticky"),t.scrollTop=t.scrollHeight}),[Ie]),(0,c.useEffect)((function(){Le&&Be(Le.chats)}),[Le]),(0,c.useEffect)((function(){n&&(xe((0,V.ZP)(z.BC,{query:{email:n.email}})),"myTickets"===Fe?H.Z.get("".concat(z.BC,"/tickets/").concat(n.company,"?email=").concat(n.email)).then((function(e){He(e.data);xt({target:{innerText:"Open"}})})):oe.includes(n.firestore.role)?H.Z.get("".concat(z.BC,"/tickets/").concat(n.company)).then((function(e){He(e.data)})):H.Z.get("".concat(z.BC,"/tickets/").concat(n.company,"?assigned=").concat(n.email)).then((function(e){He(e.data);xt({target:{innerText:"Open"}})})))}),[n,Fe]),(0,c.useEffect)((function(){if(he)return he.on("recieveMessage",(function(e){var t=e.ticketId,n=ze.find((function(e){return e._id===t}));n&&(n.chats.push(e),(null===Le||void 0===Le?void 0:Le._id)===t&&Oe((0,a.Z)({},n)))})),function(){he.off("recieveMessage")}}),[he,ze,Le]),(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(f.Z,{maxWidth:"sm",fullWidth:!0,fullScreen:"Settings"===Qe,open:qe,onClose:dt,PaperProps:{style:{maxHeight:"Settings"===Qe?null:"75vh",overflowY:"auto"}},children:(0,se.jsx)(p.Z,{sx:{mt:3,mb:3},children:(0,se.jsxs)(m.Z,{variant:"outlined",children:[(0,se.jsxs)(Z.Z,{children:["Team"!==Qe?(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,se.jsx)(h.Z,{variant:"h2",children:Qe})}),(0,se.jsx)("br",{})]}):null,"Assign Tickets"===Qe?(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(h.Z,{variant:"p",children:"Select Employee"}),(0,se.jsx)("br",{}),(0,se.jsx)(j.Z,{fullWidth:!0,children:(0,se.jsxs)(g.Z,{fullWidth:!0,id:"demo-simple-select",value:St,onChange:function(e){Pt(e.target.value)},children:[mt?(0,se.jsx)(v.Z,{value:"None",children:"None"}):(0,se.jsx)(v.Z,{value:"None",children:"No employee found"}),mt&&mt.map((function(e,t){return(0,se.jsx)(v.Z,{value:e.email,children:e.email},e.email)}))]})}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)(h.Z,{variant:"p",children:"Select Tickets to assign."}),(0,se.jsx)("br",{}),(0,se.jsx)(j.Z,{disabled:bt,fullWidth:!0,children:(0,se.jsx)(g.Z,{id:"demo-multiple-chip",multiple:!0,value:At,onChange:It,input:(0,se.jsx)(y.Z,{id:"select-multiple-chip",label:"Managers"}),renderValue:function(e){return(0,se.jsx)(b.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((function(e){return(0,se.jsx)(w.Z,{label:ze.find((function(t){return t._id===e})).title},e)}))})},MenuProps:ae,children:ze.map((function(e){var t=e._id,n=e.title;if(!e.assigned)return(0,se.jsx)(v.Z,{value:t,style:re(n,ze,Q),children:n},t)}))})})]}):"Team"===Qe?(0,se.jsx)(se.Fragment,{children:(0,se.jsx)(b.Z,{sx:{width:"100%",typography:"body1"},children:(0,se.jsxs)(q.ZP,{value:nt,children:[(0,se.jsx)(b.Z,{sx:{borderBottom:2,borderColor:"divider"},children:(0,se.jsxs)(X.Z,{onChange:function(e,t){e.preventDefault(),it(t),"1"===t&&st()},textColor:"secondary",indicatorColor:"secondary","aria-label":"lab API tabs example",centered:!0,children:[(0,se.jsx)(k.Z,{label:"Team Members",value:"1"}),(0,se.jsx)(k.Z,{label:"Add Members",value:"2"})]})}),(0,se.jsx)(G.Z,{value:"1",children:(0,se.jsx)(C.Z,{sx:{p:0},children:lt.map((function(e,t){var n;if(null!==(n=e.teams)&&void 0!==n&&n.includes("tickets"))return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)(S.ZP,{id:e.uid,sx:{p:0},secondaryAction:(0,se.jsx)(P.Z,{edge:"end","aria-label":"delete",sx:{borderRadius:"50%"},onClick:function(){K.RZ.collection(K.hJ).doc(e.uid).update({teams:$().firestore.FieldValue.arrayRemove("tickets")}).then((function(t){document.getElementById(e.uid).style.display="none"}))},children:(0,se.jsx)(U.Z,{})}),children:[(0,se.jsx)(T.Z,{children:(0,se.jsx)(u.Z,{alt:"DP",src:e.photoURL})}),(0,se.jsx)(_.Z,{primary:e.displayName,secondary:e.email})]},t),(0,se.jsx)(A.Z,{})]})}))})}),(0,se.jsxs)(G.Z,{value:"2",children:[(0,se.jsx)(h.Z,{variant:"p",children:"Select Employees"}),(0,se.jsx)("br",{}),(0,se.jsx)(j.Z,{fullWidth:!0,children:(0,se.jsx)(g.Z,{id:"demo-multiple-chip",multiple:!0,value:At,onChange:It,input:(0,se.jsx)(y.Z,{id:"select-multiple-chip",label:"Managers"}),renderValue:function(e){return(0,se.jsx)(b.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((function(e){return(0,se.jsx)(w.Z,{label:e},e)}))})},MenuProps:ae,children:lt.map((function(e){if(e.teams&&!e.teams.includes("tickets"))return(0,se.jsx)(v.Z,{value:e.email,style:re(e.email,lt,Q),children:e.email},e.email)}))})})]})]})})}):"Settings"===Qe?(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)("br",{}),(0,se.jsx)(d.ZP,{container:!0,children:(0,se.jsxs)(d.ZP,{item:!0,xs:6,children:[(0,se.jsx)(h.Z,{variant:"subtitle1",children:"Appoint a substitute:"}),(0,se.jsx)(j.Z,{fullWidth:!0,children:(0,se.jsxs)(g.Z,{fullWidth:!0,id:"demo-simple-select",value:on.appointed?on.appointed:"None",onChange:function(e){cn((function(t){return(0,a.Z)((0,a.Z)({},t),{},{appointed:e.target.value})}))},children:[lt?(0,se.jsx)(v.Z,{value:"None",children:"None"}):(0,se.jsx)(v.Z,{value:"None",children:"No employee found"}),lt&&lt.map((function(e,t){if(!rn.has(e.role))return(0,se.jsx)(v.Z,{value:e.email,children:"".concat(e.email," (").concat(e.role,")")},e.email)}))]})})]})})]}):null]}),(0,se.jsxs)(R.Z,{sx:{float:"right"},style:{padding:"0px 20px 20px"},children:[(0,se.jsx)(I.Z,{onClick:function(){"Settings"===Qe&&cn(n.firestore.settings?n.firestore.settings:{}),dt()},children:"Close"}),"1"!==nt||"Assign Tickets"===Qe?(0,se.jsx)(I.Z,{size:"small",onClick:function(){if("Team"===Qe){var e=lt.filter((function(e){return At.includes(e.email)})),t=[];e.forEach((function(e){t.push(K.RZ.collection(K.hJ).doc(e.uid).update({teams:$().firestore.FieldValue.arrayUnion("tickets")}))})),Promise.all(t).then((function(e){console.log("Teams Updated")})),it("1")}else"Assign Tickets"===Qe&&gt();dt()},variant:"contained",children:"Submit"}):"Settings"===Qe?(0,se.jsx)(I.Z,{size:"small",variant:"contained",onClick:function(){K.RZ.collection(K.hJ).doc(n.uid).update({settings:on}).then((function(){J.Am.success("Applied settings"),n.firestore.settings=on})),dt()},children:"Save"}):null]})]})})}),(0,se.jsx)(j.Z,{children:(0,se.jsxs)(B.Z,{row:!0,"aria-labelledby":"demo-controlled-radio-buttons-group",name:"controlled-radio-buttons-group",value:Fe,onChange:function(e){Ue(e.target.value)},children:[(0,se.jsx)(D.Z,{value:"myTickets",control:(0,se.jsx)(E.Z,{}),label:"My Tickets"}),(0,se.jsx)(D.Z,{value:"assigned",control:(0,se.jsx)(E.Z,{}),label:oe.includes(n.firestore.role)?"All Tickets":"Assigned Tickets"})]})}),(0,se.jsx)("br",{}),(0,se.jsx)("br",{}),(0,se.jsx)("div",{id:"ticketUIContainer",style:{border:"2px solid #f0f0f0",borderRadius:"25px",overflowY:"hidden"},children:(0,se.jsxs)(d.ZP,{container:!0,sx:{height:"100%"},children:[!1,(0,se.jsx)(d.ZP,{container:!0,item:!0,xs:me||Ft||ve?3:3.5,spacing:2,sx:{height:"100%"},children:(0,se.jsxs)(d.ZP,{item:!0,xs:12,sx:{height:"100%"},children:[(0,se.jsxs)(x.Z,{direction:"row",justifyContent:"space-around",alignItems:"center",sx:{paddingX:"7px",paddingY:"5px"},children:[oe.includes(null===n||void 0===n?void 0:n.firestore.role)&&(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(P.Z,{onClick:function(e){Gt(e.currentTarget)},children:(0,se.jsx)(ie.Z,{})}),(0,se.jsxs)(te.Z,{id:"basic-menu",anchorEl:Xt,open:Kt,onClose:Qt,MenuListProps:{"aria-labelledby":"basic-button"},children:[(0,se.jsx)(v.Z,{onClick:function(e){Qt(),ct(0,"Team")},children:"Team"}),(0,se.jsx)(v.Z,{onClick:function(e){Qt(),jt(),ct(0,"Assign Tickets"),Rt([])},children:"Assign Tickets"}),(0,se.jsx)(v.Z,{onClick:function(e){Qt(),ct(0,"Settings")},children:"Settings"})]})]}),le.map((function(e){return(0,se.jsx)(h.Z,{width:"85%",textAlign:"center",display:"itadmin"!==(null===n||void 0===n?void 0:n.firestore.role)&&"All"===e?"none":"",variant:"subtitle1",name:e,style:{cursor:"pointer",color:ke===e?"blue":"",backgroundColor:ke===e?"#ebecf0":"",borderRadius:"50px"},onClick:xt,children:e})}))]}),(0,se.jsx)(A.Z,{}),(0,se.jsx)(C.Z,{sx:{backgroundColor:"#f5f6fa",py:0,height:"98%",overflowY:"auto"},children:ze.map((function(e,t){if("All"===ke||e.status===ke.toLowerCase()){var i=new Date(e.createdOn).toDateString().split(" ");return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(L.Z,{sx:{px:1,py:1,backgroundColor:e._id===(null===Le||void 0===Le?void 0:Le._id)?"#b2ccfe":"transparent"},onClick:function(){if(e._id!==(null===Le||void 0===Le?void 0:Le._id)){var n=document.getElementById("searchBar");n.style.position="absolute",n.style.bottom="0px",Ut(!1),Oe((0,a.Z)((0,a.Z)({},e),{},{index:t})),Lt(e.status)}},children:(0,se.jsxs)(d.ZP,{container:!0,children:[(0,se.jsx)(d.ZP,{container:!0,item:!0,xs:2,justifyContent:"center",sx:{overflowX:"clip"},children:(0,se.jsx)(u.Z,{alt:"user pic",src:e.photoURL===(null===n||void 0===n?void 0:n.photoURL)?e.assigned:e.photoURL})}),(0,se.jsxs)(d.ZP,{item:!0,xs:10,children:[(0,se.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",width:"100%",children:[(0,se.jsx)(se.Fragment,{children:"itadmin"===(null===n||void 0===n?void 0:n.firestore.role)?(0,se.jsx)("div",{style:{width:"75%"},children:(0,se.jsx)(h.Z,{variant:"caption",noWrap:!0,onClick:function(){ye(!1),Ze(!0)},onMouseOver:function(e){e.target.style.color="blue"},onMouseLeave:function(e){e.target.style.color=""},children:e.name})}):(0,se.jsxs)(h.Z,{variant:"caption",style:{width:"75%"},noWrap:!0,children:["#",e._id]})}),(0,se.jsx)(h.Z,{variant:"overline",style:{width:"25%",textAlign:"right"},children:i[1]+" "+i[2]})]}),(0,se.jsx)(h.Z,{width:"100%",noWrap:!0,variant:"subtitle1",children:e.title}),(0,se.jsx)(h.Z,{width:"100%",noWrap:!0,variant:"subtitle2",children:e.desc})]})]})},e._id),t!==ze.length-1&&(0,se.jsx)(A.Z,{})]})}}))})]})}),(0,se.jsx)(A.Z,{orientation:"vertical",flexItem:!0}),(0,se.jsxs)(d.ZP,{id:"chatContainer",container:!0,item:!0,xs:me||Ft||ve?5.96:8.46,sx:{height:"100%"},children:[(0,se.jsxs)(d.ZP,{id:"chatHeader",item:!0,xs:12,children:[(0,se.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{padding:"5px"},children:[(0,se.jsxs)("div",{style:{marginLeft:"16px"},children:[Le?(0,se.jsxs)(x.Z,{direction:"row",children:[(0,se.jsx)(ee.rU,{onClick:function(){Le&&oe.includes(null===n||void 0===n?void 0:n.firestore.role)&&Ut(!0)},children:(0,se.jsx)(O.Z,{title:"View all private replies",children:(0,se.jsx)(h.Z,{variant:"h4",children:(null===Le||void 0===Le?void 0:Le.title)||"Select a ticket"})})}),(null===Le||void 0===Le?void 0:Le.assigned)&&(0,se.jsx)(O.Z,{title:oe.includes(null===n||void 0===n?void 0:n.firestore.role)?"View all private replies":"Ticket Title",children:(0,se.jsx)("img",{style:{marginLeft:"8px",height:"25px",width:"25px",float:"right"},src:"https://img.icons8.com/color/25/null/checked--v1.png"})})]}):(0,se.jsx)(h.Z,{variant:"h4",children:(null===Le||void 0===Le?void 0:Le.title)||"Select a ticket"}),(0,se.jsx)(h.Z,{variant:"body1",children:null===Le||void 0===Le?void 0:Le.desc})]}),oe.includes(null===n||void 0===n?void 0:n.firestore.role)&&(0,se.jsxs)(x.Z,{direction:"row",spacing:1,alignItems:"center",children:[null===(null===Le||void 0===Le?void 0:Le.assigned)&&(0,se.jsx)(I.Z,{size:"small",onClick:function(e){ct(0,"Assign Tickets"),wt(!0),Rt([Le._id])},children:"Assign"}),Le&&(0,se.jsx)(j.Z,{size:"small",children:(0,se.jsxs)(g.Z,{id:"demo-simple-select",value:Et,onChange:function(e){Ot(e.target.value)},children:[(0,se.jsx)(v.Z,{value:"open",children:"Open"}),(0,se.jsx)(v.Z,{value:"pending",children:"Pending"}),(0,se.jsx)(v.Z,{value:"closed",children:"Closed"})]})})]})]}),(0,se.jsx)(A.Z,{})]}),(0,se.jsx)(d.ZP,{item:!0,xs:12,sx:{height:"91%",paddingY:"4px"},children:(0,se.jsxs)("div",{id:"chatBox",style:{position:"relative",overflowY:"auto",height:"100%"},children:[(0,se.jsx)(C.Z,{sx:{p:0},children:null===Ie||void 0===Ie?void 0:Ie.map((function(e,t){return e.email===n.email&&(e.from="You"),(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(L.Z,{id:"chatLog-".concat(e._id),sx:{p:0,cursor:"default"},children:(0,se.jsx)(ce,{msg:e},t)}),(0,se.jsx)(A.Z,{})]})}))}),(0,se.jsxs)("div",{id:"searchBar",style:{position:"absolute",bottom:"0px",width:"100%",backgroundColor:"#ffffff"},children:[0!==nn.length&&(0,se.jsx)(d.ZP,{item:!0,xs:12,justifyContent:"space-evenly",children:Object.values(nn).map((function(e){return(0,se.jsx)(h.Z,{variant:"caption",children:e.name})}))}),(0,se.jsxs)(x.Z,{direction:"row",spacing:2,justifyContent:"center",sx:{width:"100%",paddingY:1},children:[(0,se.jsx)(N.Z,{placeholder:"Type your query here ...",sx:{width:"80%"},value:Te,InputProps:{endAdornment:(0,se.jsx)(W.Z,{position:"end",children:(0,se.jsxs)(P.Z,{sx:{borderRadius:"50%"},"aria-label":"toggle password visibility",onClick:function(e){return $t.current.click()},edge:"end",children:[(0,se.jsx)("input",{ref:$t,type:"file",multiple:!0,hidden:!0,onChange:function(e){return sn(e.target.files)}}),(0,se.jsx)(M.Z,{})]})})},onChange:function(e){return _e(e.target.value)}}),(0,se.jsx)(I.Z,{disabled:!Le||"itadmin"!==n.firestore.role&&!(null!==Le&&void 0!==Le&&Le.assigned),variant:"contained",onClick:function(e){if(nn.length){var t=Le,i=ut(Te,Object.values(nn),n.displayName,n.photoURL,n.email,null===Le||void 0===Le?void 0:Le.index),l=Object.values(nn).map((function(e){return new Promise((function(t,n){var i=(new Date).getTime()+e.name,s=K.tO.ref().child("/Attachments/".concat(i)).put(e);s.on("state_changed",(function(e){Math.floor(e.bytesTransferred/e.totalBytes*100)}),(function(e){console.log(e)}),(function(){s.snapshot.ref.getDownloadURL().then((function(e){t(e)})).catch((function(e){console.log(e)}))}))}))}));Promise.all(l).then((function(e){var s=n.email===t.email?t.assigned:t.email;ht({message:Te,attachments:e,to:s,from:n.displayName,email:n.email,dp:n.photoURL,ticketId:t._id,createdOn:(new Date).toISOString()}),i.attachments=e,H.Z.patch("".concat(z.BC,"/tickets/chat/").concat(t._id),{chatData:i}).then((function(e){He((function(e){var n,s=e[null===t||void 0===t?void 0:t.index];return null===s||void 0===s||null===(n=s.chats)||void 0===n||n.push((0,a.Z)((0,a.Z)({},i),{},{createdOn:(new Date).toISOString()})),e[null===t||void 0===t?void 0:t.index]=s,e}))}))}))}else!function(e,t){return function(){var i=(0,r.Z)((0,s.Z)().mark((function i(r){var a;return(0,s.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(Te){i.next=2;break}return i.abrupt("return");case 2:a=n.email===Le.email?Le.assigned:Le.email,ht({message:Te,attachments:t,to:a,from:n.displayName,email:n.email,dp:n.photoURL,ticketId:Le._id,createdOn:(new Date).toISOString()}),ut(Te,t,n.displayName,n.photoURL,n.email,e);case 5:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()}(null===Le||void 0===Le?void 0:Le.index,[])()},children:"Send"})]})]})]})})]}),me&&(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(A.Z,{orientation:"vertical",flexItem:!0}),(0,se.jsx)(d.ZP,{container:!0,item:!0,xs:3,sx:{height:"100%"},children:(0,se.jsxs)(d.ZP,{item:!0,xs:12,children:[(0,se.jsx)(P.Z,{sx:{float:"right",borderRadius:"50%"},onClick:function(){return Ze(!1)},children:(0,se.jsx)(F.Z,{})}),Le&&(0,se.jsxs)("center",{style:{padding:"40px 0px"},children:[(0,se.jsx)(u.Z,{alt:"profile user",src:Le.photoURL,sx:{width:75,height:75}}),(0,se.jsx)("br",{}),(0,se.jsx)(h.Z,{variant:"h3",children:Le.name})]}),(0,se.jsx)(A.Z,{})]})})]}),Ft&&(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(A.Z,{orientation:"vertical",flexItem:!0}),(0,se.jsxs)(d.ZP,{container:!0,item:!0,xs:3,sx:{px:1,height:"100%"},children:[(0,se.jsxs)(d.ZP,{item:!0,xs:12,sx:{height:"28%"},children:[(0,se.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,se.jsx)(h.Z,{variant:"caption",children:"All private replies"}),(0,se.jsx)(P.Z,{sx:{borderRadius:"50%"},onClick:function(){Ut(!1)},children:(0,se.jsx)(F.Z,{})})]}),Le&&(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(N.Z,{fullWidth:!0,multiline:!0,rows:3,value:zt,onChange:function(e){return Ht(e.target.value)}}),(0,se.jsx)(I.Z,{disabled:!zt,size:"small",sx:{float:"right",mt:1},variant:"contained",onClick:Vt,children:"Add"})]})]}),(0,se.jsx)(d.ZP,{item:!0,xs:12,sx:{height:"72%"},children:(0,se.jsx)(C.Z,{dense:!0,sx:{p:0,height:"100%",overflowY:"auto"},children:null===Le||void 0===Le||null===(e=Le.replies)||void 0===e?void 0:e.map((function(e){if(e.email===n.email){var t=new Date(e.createdOn||Date.now()),i=t.toDateString().split(" "),s=t.toLocaleTimeString().split(" ");return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(S.ZP,{sx:{p:0},children:(0,se.jsxs)("div",{style:{width:"100%"},children:[(0,se.jsx)(h.Z,{variant:"body1",children:e.message}),(0,se.jsxs)(x.Z,{sx:{width:"100%"},direction:"row",justifyContent:"flex-end",alignItems:"center",children:[(0,se.jsx)(h.Z,{variant:"caption",sx:{mr:1},children:i[1]+" "+i[2]}),(0,se.jsx)(h.Z,{variant:"caption",children:s[0].split(":").slice(0,2).join(":")+" "+s[1]})]})]})}),(0,se.jsx)(A.Z,{})]})}}))})})]})]})]})})]})}}}]);
//# sourceMappingURL=2384.69002c65.chunk.js.map