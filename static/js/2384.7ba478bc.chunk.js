"use strict";(self.webpackChunk_minimal_minimal_kit_react=self.webpackChunk_minimal_minimal_kit_react||[]).push([[2384],{72384:function(e,t,n){n.r(t);var i=n(12860),s=n(74165),r=n(15861),a=n(1413),l=n(93433),c=n(29439),o=n(72791),d=n(61889),u=n(60220),h=n(20890),x=n(36314),f=n(5574),p=n(10524),m=n(57621),Z=n(39504),j=n(68096),g=n(58406),v=n(23786),y=n(77196),b=n(64554),w=n(81918),k=n(43896),C=n(90493),S=n(45484),P=n(13400),T=n(20653),_=n(49900),I=n(94721),L=n(72363),A=n(24518),R=n(30829),B=n(76278),D=n(20068),E=n(48550),O=n(63466),N=n(64721),W=n(27247),F=n(99663),M=n(29598),U=n(33805),z=n(31243),H=n(44428),Y=n(75985),J=n(83449),V=n(47283),q=n(82851),X=n(26467),G=n(5154),K=n.n(G),Q=n(11087),$=n(31976),ee=n(78316),te=n(87122),ne=n(97242),ie=n(80184);function se(e,t,n){return{fontWeight:-1===t.indexOf(e)?n.typography.fontWeightRegular:n.typography.fontWeightMedium}}var re={PaperProps:{style:{maxHeight:224,width:250}}},ae=["All","Open","Pending","Closed"],le=["itadmin","admin"],ce=function(e){var t=e.msg,n=new Date(t.createdOn||Date.now()),i=n.toDateString().split(" "),s=n.toLocaleTimeString().split(" ");return(0,ie.jsxs)(d.ZP,{container:!0,item:!0,xs:12,padding:1,children:[(0,ie.jsx)(d.ZP,{item:!0,xs:.8,children:(0,ie.jsx)(u.Z,{alt:"me",src:t.dp,sx:{height:"30px",width:"30px"}})}),(0,ie.jsxs)(d.ZP,{item:!0,xs:10,children:[(0,ie.jsx)(h.Z,{variant:"subtitle1",children:t.from}),(0,ie.jsx)(h.Z,{variant:"body1",children:t.message})]}),(0,ie.jsx)(d.ZP,{item:!0,xs:1.2,children:(0,ie.jsxs)(x.Z,{justifyContent:"center",alignItems:"center",children:[(0,ie.jsx)(h.Z,{variant:"caption",children:i[1]+" "+i[2]}),(0,ie.jsx)(h.Z,{variant:"caption",children:s[0].split(":").slice(0,2).join(":")+" "+s[1]})]})}),0!==t.attachments.length&&(0,ie.jsx)(d.ZP,{item:!0,xs:12,justifyContent:"space-between",sx:{width:"100%"},children:t.attachments.map((function(e,t){return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("a",{href:"string"===typeof e?e:URL.createObjectURL(e),target:"_blank",children:"Attachment ".concat(t+1)})," "]})}))})]})};t.default=function(){var e,t=(0,ee.E)(),n=t.user,G=(t.getDataByRole,(0,o.useContext)(ne.J6)),oe=G.globalSettings,de=(G.setGlobalSettings,(0,M.Z)()),ue=(0,o.useState)(null),he=(0,c.Z)(ue,2),xe=he[0],fe=he[1],pe=(0,o.useState)(!1),me=(0,c.Z)(pe,2),Ze=me[0],je=me[1],ge=(0,o.useState)(!1),ve=(0,c.Z)(ge,2),ye=ve[0],be=ve[1],we=(0,o.useState)("All"),ke=(0,c.Z)(we,2),Ce=ke[0],Se=ke[1],Pe=(0,o.useState)(""),Te=(0,c.Z)(Pe,2),_e=Te[0],Ie=Te[1],Le=(0,o.useState)([]),Ae=(0,c.Z)(Le,2),Re=Ae[0],Be=Ae[1],De=(0,o.useState)(null),Ee=(0,c.Z)(De,2),Oe=Ee[0],Ne=Ee[1],We=(0,o.useState)("myTickets"),Fe=(0,c.Z)(We,2),Me=Fe[0],Ue=(Fe[1],(0,o.useState)([])),ze=(0,c.Z)(Ue,2),He=ze[0],Ye=ze[1],Je=o.useState(!1),Ve=(0,c.Z)(Je,2),qe=Ve[0],Xe=Ve[1],Ge=o.useState(""),Ke=(0,c.Z)(Ge,2),Qe=Ke[0],$e=Ke[1],et=o.useState("1"),tt=(0,c.Z)(et,2),nt=tt[0],it=tt[1],st=function(){var e=X.RZ.collection(X.hJ).where("company","==",n.company),t=[];e.get().then((function(e){e.forEach((function(e){var i=e.data();e.id!==n.uid&&(i.uid=e.id,t.push(i))})),ct(t)}))},rt=(0,o.useState)([]),at=(0,c.Z)(rt,2),lt=at[0],ct=at[1],ot=function(e,t){st(),At("None"),Et([]),Xe(!0),$e(t)},dt=function(){Xe(!1),Tt(!1)},ut=function(e,t,n,i,s,r){Be((function(r){return[].concat((0,l.Z)(r),[{from:n,message:e,attachments:t,dp:i,email:s}])})),Ie(""),on([]);var c=(new Date).toISOString(),o={from:n,message:e,attachments:t,email:s,dp:i};if(0!==t.length)return o;z.Z.patch("".concat(U.BC,"/tickets/chat/").concat(Oe._id),{chatData:o}).then((function(e){Ye((function(e){var t,n=e[r];return null===n||void 0===n||null===(t=n.chats)||void 0===t||t.push((0,a.Z)((0,a.Z)({},o),{},{createdOn:c})),e[r]=n,e}))}))},ht=function(e){xe.emit("sendMessage",e)},xt=function(e){e.target.innerText&&Se(e.target.innerText)},ft=(0,o.useState)(0),pt=(0,c.Z)(ft,2),mt=pt[0],Zt=pt[1],jt=new Map([["Low",0],["Medium",1],["High",2]]),gt=(0,o.useState)(null),vt=(0,c.Z)(gt,2),yt=vt[0],bt=vt[1],wt=function(){X.RZ.collection(X.hJ).where("teams","array-contains-any",["tickets"]).get().then((function(e){var t=[];e.forEach((function(e){var i=e.data();e.id!==n.uid&&(i.uid=e.id,t.push(i))})),bt(t)}))};(0,o.useEffect)((function(){wt()}),[]);var kt=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(){var t;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={selectedEmployee:Lt,selectedTasks:Dt},e.next=3,z.Z.patch("".concat(U.BC,"/tickets"),{formData:t});case 3:e.sent.data===Dt.length&&(Y.Am.success("Tickets Assigned to "+Lt),Ne((function(e){return(0,a.Z)((0,a.Z)({},e),{},{assigned:Lt})})),Ye((function(e){return Dt.forEach((function(e){He.find((function(t){return t._id===e})).assigned=Lt})),e})),At("None"),Et([]));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ct=(0,o.useState)(!1),St=(0,c.Z)(Ct,2),Pt=St[0],Tt=St[1],_t=(0,o.useState)("None"),It=(0,c.Z)(_t,2),Lt=It[0],At=It[1],Rt=(0,o.useState)([]),Bt=(0,c.Z)(Rt,2),Dt=Bt[0],Et=Bt[1],Ot=function(e){var t=e.target.value;Et(t)},Nt=(0,o.useState)("open"),Wt=(0,c.Z)(Nt,2),Ft=Wt[0],Mt=Wt[1],Ut=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(t){var n;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Oe,e.next=3,z.Z.patch("".concat(U.BC,"/tickets?operation=status"),{formData:{_id:n._id,status:t}});case 3:1===e.sent.data&&(He[n.index].status=t,Mt(t),z.Z.post("".concat(U.BC,"/email/send?service=ticket&event=").concat(t),{formData:{to:n.email,ref:n,companyName:oe.name}}).then((function(e){console.log(e.data)})));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),zt=(0,o.useState)(!1),Ht=(0,c.Z)(zt,2),Yt=Ht[0],Jt=Ht[1],Vt=(0,o.useState)(""),qt=(0,c.Z)(Vt,2),Xt=qt[0],Gt=qt[1],Kt=function(){var e=(0,r.Z)((0,s.Z)().mark((function e(){var t,r,l;return(0,s.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Oe,r={ticketId:Oe._id,reply:{email:n.email,from:n.displayName,dp:"",message:Xt}},e.next=4,z.Z.patch("".concat(U.BC,"/tickets/pvtreply"),{formData:r});case 4:200===e.sent.status&&((l=He[t.index].replies)||(0,i.Z)("temp"),l.push(r.reply),He[t.index].replies=l,(null===Oe||void 0===Oe?void 0:Oe._id)===t._id&&Ne((function(e){return(0,a.Z)((0,a.Z)({},He[t.index]),{},{index:e.index})}))),Gt("");case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Qt=(0,o.useState)(null),$t=(0,c.Z)(Qt,2),en=$t[0],tn=$t[1],nn=Boolean(en),sn=function(){tn(null)},rn=(0,o.useRef)(),an=(0,o.useState)([]),ln=(0,c.Z)(an,2),cn=ln[0],on=ln[1],dn=new Set(["admin","itadmin"]),un=(0,o.useState)((function(){return n.firestore.settings?n.firestore.settings:{}})),hn=(0,c.Z)(un,2),xn=hn[0],fn=hn[1];return(0,o.useEffect)((function(){var e=document.getElementById("ticketUIContainer");return e.style.height="".concat(window.innerHeight-108,"px"),window.addEventListener("resize",(function(){e.style.height="".concat(window.innerHeight-108,"px")})),function(){return window.removeEventListener("resize",(function(){console.log("window resize listener removed")}))}}),[]),(0,o.useEffect)((function(){var e=document.getElementById("searchBar"),t=document.getElementById("chatBox");t.scrollHeight>t.offsetHeight&&(e.style.position="sticky"),t.scrollTop=t.scrollHeight}),[Re]),(0,o.useEffect)((function(){Oe&&Be(Oe.chats)}),[Oe]),(0,o.useEffect)((function(){n&&(fe((0,H.ZP)(U.BC,{query:{email:n.email}})),"myTickets"===Me?z.Z.get("".concat(U.BC,"/tickets/").concat(n.company,"?email=").concat(n.email)).then((function(e){Ye(e.data);xt({target:{innerText:"Open"}})})):le.includes(n.firestore.role)?z.Z.get("".concat(U.BC,"/tickets/").concat(n.company)).then((function(e){Ye(e.data)})):z.Z.get("".concat(U.BC,"/tickets/").concat(n.company,"?assigned=").concat(n.email)).then((function(e){Ye(e.data);xt({target:{innerText:"Open"}})})))}),[n,Me]),(0,o.useEffect)((function(){if(xe)return xe.on("recieveMessage",(function(e){var t=e.ticketId,n=He.find((function(e){return e._id===t}));n&&(n.chats.push(e),(null===Oe||void 0===Oe?void 0:Oe._id)===t&&Ne((0,a.Z)({},n)))})),function(){xe.off("recieveMessage")}}),[xe,He,Oe]),(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(f.Z,{maxWidth:"sm",fullWidth:!0,fullScreen:"Settings"===Qe,open:qe,onClose:dt,PaperProps:{style:{maxHeight:"Settings"===Qe?null:"75vh",overflowY:"auto"}},children:(0,ie.jsx)(p.Z,{sx:{mt:3,mb:3},children:(0,ie.jsxs)(m.Z,{variant:"outlined",children:[(0,ie.jsxs)(Z.Z,{children:["Team"!==Qe?(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,ie.jsx)(h.Z,{variant:"h2",children:Qe})}),(0,ie.jsx)("br",{})]}):null,"Assign Tickets"===Qe?(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(h.Z,{variant:"p",children:"Select Employee"}),(0,ie.jsx)("br",{}),(0,ie.jsx)(j.Z,{fullWidth:!0,children:(0,ie.jsxs)(g.Z,{fullWidth:!0,id:"demo-simple-select",value:Lt,onChange:function(e){At(e.target.value)},children:[yt?(0,ie.jsx)(v.Z,{value:"None",children:"None"}):(0,ie.jsx)(v.Z,{value:"None",children:"No employee found"}),yt&&yt.map((function(e,t){return(0,ie.jsx)(v.Z,{value:e.email,children:e.email},e.email)}))]})}),(0,ie.jsx)("br",{}),(0,ie.jsx)("br",{}),(0,ie.jsx)(h.Z,{variant:"p",children:"Select Tickets to assign."}),(0,ie.jsx)("br",{}),(0,ie.jsx)(j.Z,{disabled:Pt,fullWidth:!0,children:(0,ie.jsx)(g.Z,{id:"demo-multiple-chip",multiple:!0,value:Dt,onChange:Ot,input:(0,ie.jsx)(y.Z,{id:"select-multiple-chip",label:"Managers"}),renderValue:function(e){return(0,ie.jsx)(b.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((function(e){return(0,ie.jsx)(w.Z,{label:He.find((function(t){return t._id===e})).title},e)}))})},MenuProps:re,children:He.map((function(e){var t=e._id,n=e.title;if(!e.assigned)return(0,ie.jsx)(v.Z,{value:t,style:se(n,He,de),children:n},t)}))})})]}):"Team"===Qe?(0,ie.jsx)(ie.Fragment,{children:(0,ie.jsx)(b.Z,{sx:{width:"100%",typography:"body1"},children:(0,ie.jsxs)(J.ZP,{value:nt,children:[(0,ie.jsx)(b.Z,{sx:{borderBottom:2,borderColor:"divider"},children:(0,ie.jsxs)(V.Z,{onChange:function(e,t){e.preventDefault(),it(t),"1"===t&&st()},textColor:"secondary",indicatorColor:"secondary","aria-label":"lab API tabs example",centered:!0,children:[(0,ie.jsx)(k.Z,{label:"Team Members",value:"1"}),(0,ie.jsx)(k.Z,{label:"Add Members",value:"2"})]})}),(0,ie.jsx)(q.Z,{value:"1",children:(0,ie.jsx)(C.Z,{sx:{p:0},children:lt.map((function(e,t){var n;if(null!==(n=e.teams)&&void 0!==n&&n.includes("tickets"))return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsxs)(S.ZP,{id:e.uid,sx:{p:0},secondaryAction:(0,ie.jsx)(P.Z,{edge:"end","aria-label":"delete",sx:{borderRadius:"50%"},onClick:function(){X.RZ.collection(X.hJ).doc(e.uid).update({teams:K().firestore.FieldValue.arrayRemove("tickets")}).then((function(t){document.getElementById(e.uid).style.display="none"}))},children:(0,ie.jsx)(W.Z,{})}),children:[(0,ie.jsx)(T.Z,{children:(0,ie.jsx)(u.Z,{alt:"DP",src:e.photoURL})}),(0,ie.jsx)(_.Z,{primary:e.displayName,secondary:e.email})]},t),(0,ie.jsx)(I.Z,{})]})}))})}),(0,ie.jsxs)(q.Z,{value:"2",children:[(0,ie.jsx)(h.Z,{variant:"p",children:"Select Employees"}),(0,ie.jsx)("br",{}),(0,ie.jsx)(j.Z,{fullWidth:!0,children:(0,ie.jsx)(g.Z,{id:"demo-multiple-chip",multiple:!0,value:Dt,onChange:Ot,input:(0,ie.jsx)(y.Z,{id:"select-multiple-chip",label:"Managers"}),renderValue:function(e){return(0,ie.jsx)(b.Z,{sx:{display:"flex",flexWrap:"wrap",gap:.5},children:e.map((function(e){return(0,ie.jsx)(w.Z,{label:e},e)}))})},MenuProps:re,children:lt.map((function(e){if(e.teams&&!e.teams.includes("tickets"))return(0,ie.jsx)(v.Z,{value:e.email,style:se(e.email,lt,de),children:e.email},e.email)}))})})]})]})})}):"Settings"===Qe?(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("br",{}),(0,ie.jsx)(d.ZP,{container:!0,children:(0,ie.jsxs)(d.ZP,{item:!0,xs:6,children:[(0,ie.jsx)(h.Z,{variant:"subtitle1",children:"Appoint a substitute:"}),(0,ie.jsx)(j.Z,{fullWidth:!0,children:(0,ie.jsxs)(g.Z,{fullWidth:!0,id:"demo-simple-select",value:xn.appointed?xn.appointed:"None",onChange:function(e){fn((function(t){return(0,a.Z)((0,a.Z)({},t),{},{appointed:e.target.value})}))},children:[lt?(0,ie.jsx)(v.Z,{value:"None",children:"None"}):(0,ie.jsx)(v.Z,{value:"None",children:"No employee found"}),lt&&lt.map((function(e,t){if(!dn.has(e.role))return(0,ie.jsx)(v.Z,{value:e.email,children:"".concat(e.email," (").concat(e.role,")")},e.email)}))]})})]})})]}):null]}),(0,ie.jsxs)(L.Z,{sx:{float:"right"},style:{padding:"0px 20px 20px"},children:[(0,ie.jsx)(A.Z,{onClick:function(){"Settings"===Qe&&fn(n.firestore.settings?n.firestore.settings:{}),dt()},children:"Close"}),"1"!==nt||"Assign Tickets"===Qe?(0,ie.jsx)(A.Z,{size:"small",onClick:function(){if("Team"===Qe){var e=lt.filter((function(e){return Dt.includes(e.email)})),t=[];e.forEach((function(e){t.push(X.RZ.collection(X.hJ).doc(e.uid).update({teams:K().firestore.FieldValue.arrayUnion("tickets")}))})),Promise.all(t).then((function(e){console.log("Teams Updated")})),it("1")}else"Assign Tickets"===Qe&&kt();dt()},variant:"contained",children:"Submit"}):"Settings"===Qe?(0,ie.jsx)(A.Z,{size:"small",variant:"contained",onClick:function(){X.RZ.collection(X.hJ).doc(n.uid).update({settings:xn}).then((function(){Y.Am.success("Applied settings"),n.firestore.settings=xn})),dt()},children:"Save"}):null]})]})})}),(0,ie.jsx)(j.Z,{}),(0,ie.jsx)("br",{}),(0,ie.jsx)("br",{}),(0,ie.jsx)("div",{id:"ticketUIContainer",style:{border:"2px solid #f0f0f0",borderRadius:"25px",overflowY:"hidden"},children:(0,ie.jsxs)(d.ZP,{container:!0,sx:{height:"100%"},children:[!1,(0,ie.jsx)(d.ZP,{container:!0,item:!0,xs:Ze||Yt||ye?3:3.5,spacing:2,sx:{height:"100%"},children:(0,ie.jsxs)(d.ZP,{item:!0,xs:12,sx:{height:"100%"},children:[(0,ie.jsxs)(x.Z,{direction:"row",justifyContent:"space-around",alignItems:"center",sx:{paddingX:"7px",paddingY:"5px"},children:[le.includes(null===n||void 0===n?void 0:n.firestore.role)&&(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(P.Z,{onClick:function(e){tn(e.currentTarget)},children:(0,ie.jsx)(te.Z,{})}),(0,ie.jsxs)($.Z,{id:"basic-menu",anchorEl:en,open:nn,onClose:sn,MenuListProps:{"aria-labelledby":"basic-button"},children:[(0,ie.jsx)(v.Z,{onClick:function(e){sn(),ot(0,"Team")},children:"Team"}),(0,ie.jsx)(v.Z,{onClick:function(e){sn(),wt(),ot(0,"Assign Tickets"),Et([])},children:"Assign Tickets"}),(0,ie.jsx)(v.Z,{onClick:function(e){sn(),ot(0,"Settings")},children:"Settings"})]})]}),(0,ie.jsxs)(j.Z,{size:"small",children:[(0,ie.jsx)(R.Z,{id:"tabLabel",children:"Status"}),(0,ie.jsx)(g.Z,{labelId:"tabLabel",label:"Status",id:"tab-select",value:Ce,onClick:xt,children:ae.map((function(e){if("All"!==e)return(0,ie.jsx)(v.Z,{value:e,children:e},e)}))})]}),(0,ie.jsxs)(j.Z,{size:"small",children:[(0,ie.jsx)(R.Z,{id:"priorityLabel",children:"Priority"}),(0,ie.jsxs)(g.Z,{labelId:"priorityLabel",label:"Priority",id:"priority-select",value:mt,onClick:function(e){var t=e.target.innerText;if(t){var n=jt.get(t);Zt(n)}},children:[(0,ie.jsx)(v.Z,{value:"0",children:"Low"}),(0,ie.jsx)(v.Z,{value:"1",children:"Medium"}),(0,ie.jsx)(v.Z,{value:"2",children:"High"})]})]})]}),(0,ie.jsx)(I.Z,{}),(0,ie.jsx)(C.Z,{sx:{backgroundColor:"#f5f6fa",py:0,height:"95%",overflowY:"auto"},children:He.map((function(e,t){if("All"===Ce||e.status===(null===Ce||void 0===Ce?void 0:Ce.toLowerCase())){if("number"===typeof e.priority){if(e.priority!==mt)return}else if(0!==mt)return;var i=new Date(e.createdOn).toDateString().split(" ");return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(B.Z,{sx:{px:1,py:1,backgroundColor:e._id===(null===Oe||void 0===Oe?void 0:Oe._id)?"#b2ccfe":"transparent"},onClick:function(){if(e._id!==(null===Oe||void 0===Oe?void 0:Oe._id)){var n=document.getElementById("searchBar");n.style.position="absolute",n.style.bottom="0px",Jt(!1),Ne((0,a.Z)((0,a.Z)({},e),{},{index:t})),Mt(e.status)}},children:(0,ie.jsxs)(d.ZP,{container:!0,children:[(0,ie.jsx)(d.ZP,{container:!0,item:!0,xs:2,justifyContent:"center",sx:{overflowX:"clip"},children:(0,ie.jsx)(u.Z,{alt:"user pic",src:e.photoURL===(null===n||void 0===n?void 0:n.photoURL)?e.assigned:e.photoURL})}),(0,ie.jsxs)(d.ZP,{item:!0,xs:10,children:[(0,ie.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",width:"100%",children:[(0,ie.jsx)(ie.Fragment,{children:"itadmin"===(null===n||void 0===n?void 0:n.firestore.role)?(0,ie.jsx)("div",{style:{width:"75%"},children:(0,ie.jsx)(h.Z,{variant:"caption",noWrap:!0,onClick:function(){be(!1),je(!0)},onMouseOver:function(e){e.target.style.color="blue"},onMouseLeave:function(e){e.target.style.color=""},children:e.name})}):(0,ie.jsxs)(h.Z,{variant:"caption",style:{width:"75%"},noWrap:!0,children:["#",e._id]})}),(0,ie.jsx)(h.Z,{variant:"overline",style:{width:"25%",textAlign:"right"},children:i[1]+" "+i[2]})]}),(0,ie.jsx)(h.Z,{width:"100%",noWrap:!0,variant:"subtitle1",children:e.title}),(0,ie.jsx)(h.Z,{width:"100%",noWrap:!0,variant:"subtitle2",children:e.desc})]})]})},e._id),t!==He.length-1&&(0,ie.jsx)(I.Z,{})]})}}))})]})}),(0,ie.jsx)(I.Z,{orientation:"vertical",flexItem:!0}),(0,ie.jsxs)(d.ZP,{id:"chatContainer",container:!0,item:!0,xs:Ze||Yt||ye?5.96:8.46,sx:{height:"100%"},children:[(0,ie.jsxs)(d.ZP,{id:"chatHeader",item:!0,xs:12,children:[(0,ie.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",sx:{padding:"5px"},children:[(0,ie.jsxs)("div",{style:{marginLeft:"16px"},children:[Oe?(0,ie.jsxs)(x.Z,{direction:"row",children:[(0,ie.jsx)(Q.rU,{onClick:function(){Oe&&le.includes(null===n||void 0===n?void 0:n.firestore.role)&&Jt(!0)},children:(0,ie.jsx)(D.Z,{title:le.includes(null===n||void 0===n?void 0:n.firestore.role)?"View all private replies":"Ticket Title",children:(0,ie.jsx)(h.Z,{variant:"h4",children:(null===Oe||void 0===Oe?void 0:Oe.title)||"Select a ticket"})})}),(null===Oe||void 0===Oe?void 0:Oe.assigned)&&(0,ie.jsx)(D.Z,{title:"Assigned to ".concat(null===Oe||void 0===Oe?void 0:Oe.assigned),children:(0,ie.jsx)("img",{style:{marginLeft:"8px",height:"25px",width:"25px",float:"right"},src:"https://img.icons8.com/color/25/null/checked--v1.png"})})]}):(0,ie.jsx)(h.Z,{variant:"h4",children:(null===Oe||void 0===Oe?void 0:Oe.title)||"Select a ticket"}),(0,ie.jsx)(h.Z,{variant:"body1",children:null===Oe||void 0===Oe?void 0:Oe.desc})]}),le.includes(null===n||void 0===n?void 0:n.firestore.role)&&(0,ie.jsxs)(x.Z,{direction:"row",spacing:1,alignItems:"center",children:[Oe&&(0,ie.jsx)(A.Z,{size:"small",onClick:function(e){ot(0,"Assign Tickets"),Tt(!0),Et([Oe._id])},children:null===(null===Oe||void 0===Oe?void 0:Oe.assigned)?"Assign":"Re-Assign"}),Oe&&(0,ie.jsx)(j.Z,{size:"small",children:(0,ie.jsxs)(g.Z,{id:"demo-simple-select",value:Ft,onChange:function(e){Ut(e.target.value)},children:[(0,ie.jsx)(v.Z,{value:"open",children:"Open"}),(0,ie.jsx)(v.Z,{value:"pending",children:"Pending"}),(0,ie.jsx)(v.Z,{value:"closed",children:"Closed"})]})})]})]}),(0,ie.jsx)(I.Z,{})]}),(0,ie.jsx)(d.ZP,{item:!0,xs:12,sx:{height:"91%",paddingY:"4px"},children:(0,ie.jsxs)("div",{id:"chatBox",style:{position:"relative",overflowY:"auto",height:"100%"},children:[(0,ie.jsx)(C.Z,{sx:{p:0},children:null===Re||void 0===Re?void 0:Re.map((function(e,t){return e.email===n.email&&(e.from="You"),(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(B.Z,{id:"chatLog-".concat(e._id),sx:{p:0,cursor:"default"},children:(0,ie.jsx)(ce,{msg:e},t)}),(0,ie.jsx)(I.Z,{})]})}))}),(0,ie.jsxs)("div",{id:"searchBar",style:{position:"absolute",bottom:"0px",width:"100%",backgroundColor:"#ffffff"},children:[0!==cn.length&&(0,ie.jsx)(d.ZP,{item:!0,xs:12,justifyContent:"space-evenly",children:Object.values(cn).map((function(e){return(0,ie.jsx)(h.Z,{variant:"caption",children:e.name})}))}),(0,ie.jsxs)(x.Z,{direction:"row",spacing:2,justifyContent:"center",sx:{width:"100%",paddingY:1},children:[(0,ie.jsx)(E.Z,{placeholder:"Type your query here ...",sx:{width:"80%"},value:_e,InputProps:{endAdornment:(0,ie.jsx)(O.Z,{position:"end",children:(0,ie.jsxs)(P.Z,{sx:{borderRadius:"50%"},"aria-label":"toggle password visibility",onClick:function(e){return rn.current.click()},edge:"end",children:[(0,ie.jsx)("input",{ref:rn,type:"file",multiple:!0,hidden:!0,onChange:function(e){return on(e.target.files)}}),(0,ie.jsx)(F.Z,{})]})})},onChange:function(e){return Ie(e.target.value)}}),(0,ie.jsx)(A.Z,{disabled:!Oe||"itadmin"!==n.firestore.role&&!(null!==Oe&&void 0!==Oe&&Oe.assigned),variant:"contained",onClick:function(e){if(cn.length){var t=Oe,i=ut(_e,Object.values(cn),n.displayName,n.photoURL,n.email,null===Oe||void 0===Oe?void 0:Oe.index),l=Object.values(cn).map((function(e){return new Promise((function(t,n){var i=(new Date).getTime()+e.name,s=X.tO.ref().child("/Attachments/".concat(i)).put(e);s.on("state_changed",(function(e){Math.floor(e.bytesTransferred/e.totalBytes*100)}),(function(e){console.log(e)}),(function(){s.snapshot.ref.getDownloadURL().then((function(e){t(e)})).catch((function(e){console.log(e)}))}))}))}));Promise.all(l).then((function(e){var s=n.email===t.email?t.assigned:t.email;ht({message:_e,attachments:e,to:s,from:n.displayName,email:n.email,dp:n.photoURL,ticketId:t._id,createdOn:(new Date).toISOString()}),i.attachments=e,z.Z.patch("".concat(U.BC,"/tickets/chat/").concat(t._id),{chatData:i}).then((function(e){Ye((function(e){var n,s=e[null===t||void 0===t?void 0:t.index];return null===s||void 0===s||null===(n=s.chats)||void 0===n||n.push((0,a.Z)((0,a.Z)({},i),{},{createdOn:(new Date).toISOString()})),e[null===t||void 0===t?void 0:t.index]=s,e}))}))}))}else!function(e,t){return function(){var i=(0,r.Z)((0,s.Z)().mark((function i(r){var a;return(0,s.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(_e){i.next=2;break}return i.abrupt("return");case 2:a=n.email===Oe.email?Oe.assigned:Oe.email,ht({message:_e,attachments:t,to:a,from:n.displayName,email:n.email,dp:n.photoURL,ticketId:Oe._id,createdOn:(new Date).toISOString()}),ut(_e,t,n.displayName,n.photoURL,n.email,e);case 5:case"end":return i.stop()}}),i)})));return function(e){return i.apply(this,arguments)}}()}(null===Oe||void 0===Oe?void 0:Oe.index,[])()},children:"Send"})]})]})]})})]}),Ze&&(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(I.Z,{orientation:"vertical",flexItem:!0}),(0,ie.jsx)(d.ZP,{container:!0,item:!0,xs:3,sx:{height:"100%"},children:(0,ie.jsxs)(d.ZP,{item:!0,xs:12,children:[(0,ie.jsx)(P.Z,{sx:{float:"right",borderRadius:"50%"},onClick:function(){return je(!1)},children:(0,ie.jsx)(N.Z,{})}),Oe&&(0,ie.jsxs)("center",{style:{padding:"40px 0px"},children:[(0,ie.jsx)(u.Z,{alt:"profile user",src:Oe.photoURL,sx:{width:75,height:75}}),(0,ie.jsx)("br",{}),(0,ie.jsx)(h.Z,{variant:"h3",children:Oe.name})]}),(0,ie.jsx)(I.Z,{})]})})]}),Yt&&(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(I.Z,{orientation:"vertical",flexItem:!0}),(0,ie.jsxs)(d.ZP,{container:!0,item:!0,xs:3,sx:{px:1,height:"100%"},children:[(0,ie.jsxs)(d.ZP,{item:!0,xs:12,sx:{height:"28%"},children:[(0,ie.jsxs)(x.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,ie.jsx)(h.Z,{variant:"caption",children:"All private replies"}),(0,ie.jsx)(P.Z,{sx:{borderRadius:"50%"},onClick:function(){Jt(!1)},children:(0,ie.jsx)(N.Z,{})})]}),Oe&&(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(E.Z,{fullWidth:!0,multiline:!0,rows:3,value:Xt,onChange:function(e){return Gt(e.target.value)}}),(0,ie.jsx)(A.Z,{disabled:!Xt,size:"small",sx:{float:"right",mt:1},variant:"contained",onClick:Kt,children:"Add"})]})]}),(0,ie.jsx)(d.ZP,{item:!0,xs:12,sx:{height:"72%"},children:(0,ie.jsx)(C.Z,{dense:!0,sx:{p:0,height:"100%",overflowY:"auto"},children:null===Oe||void 0===Oe||null===(e=Oe.replies)||void 0===e?void 0:e.map((function(e){if(e.email===n.email){var t=new Date(e.createdOn||Date.now()),i=t.toDateString().split(" "),s=t.toLocaleTimeString().split(" ");return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(S.ZP,{sx:{p:0},children:(0,ie.jsxs)("div",{style:{width:"100%"},children:[(0,ie.jsx)(h.Z,{variant:"body1",children:e.message}),(0,ie.jsxs)(x.Z,{sx:{width:"100%"},direction:"row",justifyContent:"flex-end",alignItems:"center",children:[(0,ie.jsx)(h.Z,{variant:"caption",sx:{mr:1},children:i[1]+" "+i[2]}),(0,ie.jsx)(h.Z,{variant:"caption",children:s[0].split(":").slice(0,2).join(":")+" "+s[1]})]})]})}),(0,ie.jsx)(I.Z,{})]})}}))})})]})]})]})})]})}}}]);
//# sourceMappingURL=2384.7ba478bc.chunk.js.map